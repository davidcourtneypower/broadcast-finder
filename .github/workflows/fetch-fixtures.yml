name: API Sports Integration

on:
  schedule:
    - cron: '0 */3 * * *'   # Fetch & Cleanup: Every 3 hours (12 AM, 6 AM, 12 PM, 6 PM UTC)
  workflow_dispatch:          # Allow manual trigger

jobs:
  fetch-fixtures:
    runs-on: ubuntu-latest
    steps:
      - name: Fetch Football Fixtures from API-Sports.io
        run: |
          curl -X POST "${{ secrets.PROJECT_URL }}/functions/v1/fetch-fixtures" \
            -H "Authorization: Bearer ${{ secrets.SERVICE_ROLE_KEY }}" \
            -H "Content-Type: application/json" \
            -d '{"sport":"football","dates":["today","tomorrow"],"trigger":"scheduled"}'

      - name: Fetch Basketball Fixtures from API-Sports.io
        run: |
          curl -X POST "${{ secrets.PROJECT_URL }}/functions/v1/fetch-fixtures" \
            -H "Authorization: Bearer ${{ secrets.SERVICE_ROLE_KEY }}" \
            -H "Content-Type: application/json" \
            -d '{"sport":"basketball","dates":["today","tomorrow"],"trigger":"scheduled"}'

  cleanup-old-data:
    runs-on: ubuntu-latest
    steps:
      - name: Cleanup Old Fixtures
        run: |
          curl -X POST "${{ secrets.PROJECT_URL }}/functions/v1/cleanup-old-data" \
            -H "Authorization: Bearer ${{ secrets.SERVICE_ROLE_KEY }}" \
            -H "Content-Type: application/json"
