name: API Sports Integration

on:
  schedule:
    - cron: '0 6,18 * * *'  # Fetch: 6 AM and 6 PM UTC (Football & Basketball)
    - cron: '0 2 * * *'     # Cleanup: 2 AM UTC daily
  workflow_dispatch:          # Allow manual trigger

jobs:
  fetch-fixtures:
    if: github.event.schedule == '0 6,18 * * *' || github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    steps:
      - name: Fetch Football Fixtures from API-Sports.io
        run: |
          curl -X POST "${{ secrets.PROJECT_URL }}/functions/v1/fetch-fixtures" \
            -H "Authorization: Bearer ${{ secrets.SERVICE_ROLE_KEY }}" \
            -H "Content-Type: application/json" \
            -d '{"sport":"football","dates":["today","tomorrow"],"trigger":"scheduled"}'

      - name: Fetch Basketball Fixtures from API-Sports.io
        run: |
          curl -X POST "${{ secrets.PROJECT_URL }}/functions/v1/fetch-fixtures" \
            -H "Authorization: Bearer ${{ secrets.SERVICE_ROLE_KEY }}" \
            -H "Content-Type: application/json" \
            -d '{"sport":"basketball","dates":["today","tomorrow"],"trigger":"scheduled"}'

  cleanup-old-data:
    if: github.event.schedule == '0 2 * * *' || github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    steps:
      - name: Cleanup Old Fixtures
        run: |
          curl -X POST "${{ secrets.PROJECT_URL }}/functions/v1/cleanup-old-data" \
            -H "Authorization: Bearer ${{ secrets.SERVICE_ROLE_KEY }}" \
            -H "Content-Type: application/json"
